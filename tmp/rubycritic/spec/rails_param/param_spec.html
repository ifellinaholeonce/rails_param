<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ruby Critic - Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- StyleSheets -->
    <link href="../../assets/stylesheets/bootstrap.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/stylesheets/font-awesome.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  </head>

  <body>
    <header class="navbar navbar-default navbar-fixed-top">
      <a href="#menu-toggle" class="btn btn-default hidden-lg visible-sm-* hidden-md visible-xs-* pull-left" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a>
      <a href="../../overview.html"><img src="../../assets/images/logo.png" alt="Ruby Critic Logo" title="Ruby Critic Logo" width="55"><span class="logo">RUBYCRITIC</span></a>
      
    </header>
    <div id="wrapper">
      <!-- Sidebar -->
      <aside id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-item">
            <a href="../../overview.html" class="project-nav-item overview-nav"><i class="fa fa-dashboard"></i>Overview</a>
          </li>
          <li class="sidebar-item">
            <a href="../../code_index.html" class="project-nav-item code-index-nav"><i class="fa fa-code"></i>Code</a>
          </li>
          <li class="sidebar-item">
            <a href="../../smells_index.html" class="project-nav-item smells-index-nav"><i class="fa fa-warning"></i>Smells</a>
          </li>
          <li class="sidebar-item">
            <a href="../../simple_cov_index.html" class="project-nav-item coverage-index-nav"><i class="fa fa-umbrella"></i>Coverage</a>
          </li>
        </ul>
      </aside>
      <!-- /#sidebar-wrapper -->
      <div id="page-content-wrapper">
        <div class="container-fluid">
          <div class="row">
  <!--Page Title -->
  <div class="Page_Title">
    <div class="file-time">
      <span class="committed-at">
        
          Updated <time class='js-timeago' datetime='2019-10-07 16:48:09 +0100'>2019-10-07 16:48:09 +0100</time>
        
      </span>
    </div>
    <div>
      <h3><small>spec/rails_param /</small> param_spec.rb</h3>
    </div>
  </div>
  <!--End Page Title -->
  <div class="Content_Wrapper">
    <!-- code detail -->
    <div class="code-top-detail clearfix row">
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-1">
            <div class="rating f big">
              F
            </div>
          </div>
          <div class="code-statistics col-md-11">
            <div class="col-md-3">
              <div><span class="metric">638</span><small> lines of codes</small></div>
              <div><span class="metric">2</span><small> methods</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">1143.6</span><small> complexity/method</small></div>
              <div><span class="metric">23</span><small> churn</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">2287.26</span><small> complexity</small></div>
              <div><span class="metric">1128</span><small> duplications</small></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="code-tabs">
          <ul class="nav nav-pills right-to-left">
            <li><a href="#" id="toggle-code" class="toggle-button button">code</a></li>
            <li class="active">
              <a href="#" id="toggle-smells" class="toggle-button button">
                46
                smells
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <code class="prettyprint linenums lang-ruby file-code js-file-code">require &#39;rails_param/param&#39;
require &#39;action_controller&#39;

if RUBY_VERSION &gt;= &#39;2.6.0&#39; and Rails.version &lt; &#39;5&#39;
  class ActionController::TestResponse &lt; ActionDispatch::TestResponse<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Irresponsible-Module.md" target="_blank"><b>IrresponsibleModule</b></a>        </span>      </div>      <span>ActionController::TestResponse has no descriptive comment</span>          </div>  </li></ol>
    def recycle!<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Missing-Safe-Method.md" target="_blank"><b>MissingSafeMethod</b></a>        </span>      </div>      <span>ActionController::TestResponse has missing safe method 'recycle!'</span>          </div>  </li></ol>
      # hack to avoid MonitorMixin double-initialize error:
      @mon_mutex_owner_object_id = nil
      @mon_mutex = nil
      initialize
    end
  end
end

class MyController &lt; ActionController::Base<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Irresponsible-Module.md" target="_blank"><b>IrresponsibleModule</b></a>        </span>      </div>      <span>MyController has no descriptive comment</span>          </div>  </li></ol>
  include RailsParam::Param

  def params;
  end
end

describe RailsParam::Param do

  describe &quot;.param!&quot; do
    let(:controller) { MyController.new }
    it &quot;defines the method&quot; do
      expect(controller).to respond_to(:param!)
    end

    describe &quot;transform&quot; do
      context &quot;with a method&quot; do
        it &quot;transforms the value&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(transform)::context(with a method)::it#transforms the value has a flog score of 25</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;word&quot; =&gt; &quot;foo&quot; })
          controller.param! :word, String, transform: :upcase
          expect(controller.params[&quot;word&quot;]).to eql(&quot;FOO&quot;)
        end
      end

      context &quot;with a block&quot; do
        it &quot;transforms the value&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(transform)::context(with a block)::it#transforms the value has a flog score of 30</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;word&quot; =&gt; &quot;FOO&quot; })
          controller.param! :word, String, transform: lambda { |n| n.downcase }
          expect(controller.params[&quot;word&quot;]).to eql(&quot;foo&quot;)
        end

        it &quot;transforms falsey value&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(transform)::context(with a block)::it#transforms falsey value has a flog score of 28</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;0&quot; })
          controller.param! :foo, :boolean, transform: lambda { |n| n ? &quot;bar&quot; : &quot;no bar&quot; }
          expect(controller.params[&quot;foo&quot;]).to eql(&quot;no bar&quot;)
        end
      end
    end

    describe &quot;default&quot; do
      context &quot;with a value&quot; do
        it &quot;defaults to the value&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(default)::context(with a value)::it#defaults to the value has a flog score of 26</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({})
          controller.param! :word, String, default: &quot;foo&quot;
          expect(controller.params[&quot;word&quot;]).to eql(&quot;foo&quot;)
        end

        it &quot;does not default to the value if value already provided&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(default)::context(with a value)::it#does not default to the value if value already provided has a flog score of 26</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;word&quot; =&gt; &quot;bar&quot; })
          controller.param! :word, String, default: &quot;foo&quot;
          expect(controller.params[&quot;word&quot;]).to eql(&quot;bar&quot;)
        end
      end

      context &quot;with a block&quot; do
        it &quot;defaults to the block value&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(default)::context(with a block)::it#defaults to the block value has a flog score of 28</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({})
          controller.param! :foo, :boolean, default: lambda { false }
          expect(controller.params[&quot;foo&quot;]).to eql(false)
        end

        it &quot;does not default to the value if value already provided&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(default)::context(with a block)::it#does not default to the value if value already provided has a flog score of 28</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;bar&quot; })
          controller.param! :foo, String, default: lambda { &#39;not bar&#39; }
          expect(controller.params[&quot;foo&quot;]).to eql(&quot;bar&quot;)
        end
      end
    end

    describe &quot;coerce&quot; do
      describe &quot;String&quot; do
        it &quot;will convert to String&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(String)::it#will convert to String has a flog score of 25</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; :bar })
          controller.param! :foo, String
          expect(controller.params[&quot;foo&quot;]).to eql(&quot;bar&quot;)
        end
      end

      describe &quot;Integer&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L93" class="js-smell-location">0</a>                  <a href="param_spec.html#L111" class="js-smell-location">1</a>                  </div>  </li></ol>
        it &quot;will convert to Integer if the value is valid&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(Integer)::it#will convert to Integer if the value is valid has a flog score of 26</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;42&quot; })
          controller.param! :foo, Integer
          expect(controller.params[&quot;foo&quot;]).to eql(42)
        end

        it &quot;will raise InvalidParameterError if the value is not valid&quot; do
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;notInteger&quot; })
          expect { controller.param! :foo, Integer }.to raise_error(RailsParam::Param::InvalidParameterError)
        end

        it &quot;will raise InvalidParameterError if the value is a boolean&quot; do
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; true })
          expect { controller.param! :foo, Integer }.to raise_error(RailsParam::Param::InvalidParameterError)
        end
      end

      describe &quot;Float&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L93" class="js-smell-location">0</a>                  <a href="param_spec.html#L111" class="js-smell-location">1</a>                  </div>  </li></ol>
        it &quot;will convert to Float&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(Float)::it#will convert to Float has a flog score of 26</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;42.22&quot; })
          controller.param! :foo, Float
          expect(controller.params[&quot;foo&quot;]).to eql(42.22)
        end

        it &quot;will raise InvalidParameterError if the value is not valid&quot; do
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;notFloat&quot; })
          expect { controller.param! :foo, Float }.to raise_error(RailsParam::Param::InvalidParameterError)
        end

        it &quot;will raise InvalidParameterError if the value is a boolean&quot; do
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; true })
          expect { controller.param! :foo, Float }.to raise_error(RailsParam::Param::InvalidParameterError)
        end
      end

      describe &quot;Array&quot; do
        it &quot;will convert to Array&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(Array)::it#will convert to Array has a flog score of 26</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;2,3,4,5&quot; })
          controller.param! :foo, Array
          expect(controller.params[&quot;foo&quot;]).to eql([&quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;])
        end

        it &quot;will raise InvalidParameterError if the value is a boolean&quot; do
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; true })
          expect { controller.param! :foo, Array }.to raise_error(RailsParam::Param::InvalidParameterError)
        end
      end

      describe &quot;Hash&quot; do
        it &quot;will convert to Hash&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(Hash)::it#will convert to Hash has a flog score of 26</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;key1:foo,key2:bar&quot; })
          controller.param! :foo, Hash
          expect(controller.params[&quot;foo&quot;]).to eql({ &quot;key1&quot; =&gt; &quot;foo&quot;, &quot;key2&quot; =&gt; &quot;bar&quot; })
        end

        it &quot;will raise InvalidParameterError if the value is a boolean&quot; do
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; true })
          expect { controller.param! :foo, Hash }.to raise_error(RailsParam::Param::InvalidParameterError)
        end
      end

      describe &quot;Date&quot; do
        context &quot;default condition&quot; do
          it &quot;will convert to DateTime&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(Date)::context(default condition)::it#will convert to DateTime has a flog score of 31</span>          </div>  </li></ol>
            allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;1984-01-10&quot; })
            controller.param! :foo, Date
            expect(controller.params[&quot;foo&quot;]).to eql(Date.new(1984, 1, 10))
          end

          it &quot;will raise InvalidParameterError if the value is not valid&quot; do
            allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;notDate&quot; })
            expect { controller.param! :foo, Date }.to raise_error(RailsParam::Param::InvalidParameterError)
          end
        end

        context &quot;with format&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 3 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L169" class="js-smell-location">0</a>                  <a href="param_spec.html#L202" class="js-smell-location">1</a>                  <a href="param_spec.html#L235" class="js-smell-location">2</a>                  </div>  </li></ol>
          it &quot;will convert to DateTime&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(Date)::context(with format)::it#will convert to DateTime has a flog score of 31</span>          </div>  </li></ol>
            allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;1984-01-10T12:25:00.000+02:00&quot; })
            controller.param! :foo, Date, format: &quot;%F&quot;
            expect(controller.params[&quot;foo&quot;]).to eql(Date.new(1984, 1, 10))
          end

          it &quot;will raise InvalidParameterError if the value is not valid&quot; do
            allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;notDate&quot; })
            expect { controller.param! :foo, DateTime, format: &quot;%F&quot; }.to raise_error(RailsParam::Param::InvalidParameterError)
          end

          it &quot;will raise InvalidParameterError if the format is not valid&quot; do
            allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;1984-01-10&quot; })
            expect { controller.param! :foo, DateTime, format: &quot;%x&quot; }.to raise_error(RailsParam::Param::InvalidParameterError)
          end
        end
      end

      describe &quot;Time&quot; do
        context &quot;default condition&quot; do
          it &quot;will convert to Time&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(Time)::context(default condition)::it#will convert to Time has a flog score of 33</span>          </div>  </li></ol>
            allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;2014-08-07T12:25:00.000+02:00&quot; })
            controller.param! :foo, Time
            expect(controller.params[&quot;foo&quot;]).to eql(Time.new(2014, 8, 7, 12, 25, 0, 7200))
          end

          it &quot;will raise InvalidParameterError if the value is not valid&quot; do
            allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;notTime&quot; })
            expect { controller.param! :foo, Time }.to raise_error(RailsParam::Param::InvalidParameterError)
          end
        end

        context &quot;with format&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 3 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L169" class="js-smell-location">0</a>                  <a href="param_spec.html#L202" class="js-smell-location">1</a>                  <a href="param_spec.html#L235" class="js-smell-location">2</a>                  </div>  </li></ol>
          it &quot;will convert to Time&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(Time)::context(with format)::it#will convert to Time has a flog score of 31</span>          </div>  </li></ol>
            allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;2014-08-07T12:25:00.000+02:00&quot; })
            controller.param! :foo, Time, format: &quot;%F&quot;
            expect(controller.params[&quot;foo&quot;]).to eql(Time.new(2014, 8, 7))
          end

          it &quot;will raise InvalidParameterError if the value is not valid&quot; do
            allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;notDate&quot; })
            expect { controller.param! :foo, Time, format: &quot;%F&quot; }.to raise_error(RailsParam::Param::InvalidParameterError)
          end

          it &quot;will raise InvalidParameterError if the format is not valid&quot; do
            allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;2014-08-07T12:25:00.000+02:00&quot; })
            expect { controller.param! :foo, Time, format: &quot;%x&quot; }.to raise_error(RailsParam::Param::InvalidParameterError)
          end
        end
      end

      describe &quot;DateTime&quot; do
        context &quot;default condition&quot; do
          it &quot;will convert to DateTime&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(DateTime)::context(default condition)::it#will convert to DateTime has a flog score of 32</span>          </div>  </li></ol>
            allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;2014-08-07T12:25:00.000+02:00&quot; })
            controller.param! :foo, DateTime
            expect(controller.params[&quot;foo&quot;]).to eql(DateTime.new(2014, 8, 7, 12, 25, 0, &#39;+2&#39;))
          end

          it &quot;will raise InvalidParameterError if the value is not valid&quot; do
            allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;notTime&quot; })
            expect { controller.param! :foo, DateTime }.to raise_error(RailsParam::Param::InvalidParameterError)
          end
        end

        context &quot;with format&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 3 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L169" class="js-smell-location">0</a>                  <a href="param_spec.html#L202" class="js-smell-location">1</a>                  <a href="param_spec.html#L235" class="js-smell-location">2</a>                  </div>  </li></ol>
          it &quot;will convert to DateTime&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(DateTime)::context(with format)::it#will convert to DateTime has a flog score of 31</span>          </div>  </li></ol>
            allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;2014-08-07T12:25:00.000+02:00&quot; })
            controller.param! :foo, DateTime, format: &quot;%F&quot;
            expect(controller.params[&quot;foo&quot;]).to eql(DateTime.new(2014, 8, 7))
          end

          it &quot;will raise InvalidParameterError if the value is not valid&quot; do
            allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;notDate&quot; })
            expect { controller.param! :foo, DateTime, format: &quot;%F&quot; }.to raise_error(RailsParam::Param::InvalidParameterError)
          end

          it &quot;will raise InvalidParameterError if the format is not valid&quot; do
            allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;2014-08-07T12:25:00.000+02:00&quot; })
            expect { controller.param! :foo, DateTime, format: &quot;%x&quot; }.to raise_error(RailsParam::Param::InvalidParameterError)
          end
        end
      end

      describe &quot;BigDecimals&quot; do
        it &quot;converts to BigDecimal using default precision&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(BigDecimals)::it#converts to BigDecimal using default precision has a flog score of 26</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; 12345.67890123456 })
          controller.param! :foo, BigDecimal
          expect(controller.params[&quot;foo&quot;]).to eql 12345.678901235
        end

        it &quot;converts to BigDecimal using precision option&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(BigDecimals)::it#converts to BigDecimal using precision option has a flog score of 26</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; 12345.6789 })
          controller.param! :foo, BigDecimal, precision: 6
          expect(controller.params[&quot;foo&quot;]).to eql 12345.7
        end

        it &quot;converts formatted currency string to big decimal&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(BigDecimals)::it#converts formatted currency string to big decimal has a flog score of 26</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;$100,000&quot; })
          controller.param! :foo, BigDecimal
          expect(controller.params[&quot;foo&quot;]).to eql 100000.0
        end

      end

      describe &quot;booleans&quot; do
        it &quot;converts 1/0&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 5 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L276" class="js-smell-location">0</a>                  <a href="param_spec.html#L286" class="js-smell-location">1</a>                  <a href="param_spec.html#L296" class="js-smell-location">2</a>                  <a href="param_spec.html#L306" class="js-smell-location">3</a>                  <a href="param_spec.html#L316" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(booleans)::it#converts 1/0 has a flog score of 50</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;1&quot; })
          controller.param! :foo, TrueClass
          expect(controller.params[&quot;foo&quot;]).to eql(true)

          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;0&quot; })
          controller.param! :foo, TrueClass
          expect(controller.params[&quot;foo&quot;]).to eql(false)
        end

        it &quot;converts true/false&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 5 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L276" class="js-smell-location">0</a>                  <a href="param_spec.html#L286" class="js-smell-location">1</a>                  <a href="param_spec.html#L296" class="js-smell-location">2</a>                  <a href="param_spec.html#L306" class="js-smell-location">3</a>                  <a href="param_spec.html#L316" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(booleans)::it#converts true/false has a flog score of 50</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;true&quot; })
          controller.param! :foo, TrueClass
          expect(controller.params[&quot;foo&quot;]).to eql(true)

          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;false&quot; })
          controller.param! :foo, TrueClass
          expect(controller.params[&quot;foo&quot;]).to eql(false)
        end

        it &quot;converts t/f&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 5 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L276" class="js-smell-location">0</a>                  <a href="param_spec.html#L286" class="js-smell-location">1</a>                  <a href="param_spec.html#L296" class="js-smell-location">2</a>                  <a href="param_spec.html#L306" class="js-smell-location">3</a>                  <a href="param_spec.html#L316" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(booleans)::it#converts t/f has a flog score of 50</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;t&quot; })
          controller.param! :foo, TrueClass
          expect(controller.params[&quot;foo&quot;]).to eql(true)

          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;f&quot; })
          controller.param! :foo, TrueClass
          expect(controller.params[&quot;foo&quot;]).to eql(false)
        end

        it &quot;converts yes/no&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 5 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L276" class="js-smell-location">0</a>                  <a href="param_spec.html#L286" class="js-smell-location">1</a>                  <a href="param_spec.html#L296" class="js-smell-location">2</a>                  <a href="param_spec.html#L306" class="js-smell-location">3</a>                  <a href="param_spec.html#L316" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(booleans)::it#converts yes/no has a flog score of 50</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;yes&quot; })
          controller.param! :foo, TrueClass
          expect(controller.params[&quot;foo&quot;]).to eql(true)

          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;no&quot; })
          controller.param! :foo, TrueClass
          expect(controller.params[&quot;foo&quot;]).to eql(false)
        end

        it &quot;converts y/n&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 5 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L276" class="js-smell-location">0</a>                  <a href="param_spec.html#L286" class="js-smell-location">1</a>                  <a href="param_spec.html#L296" class="js-smell-location">2</a>                  <a href="param_spec.html#L306" class="js-smell-location">3</a>                  <a href="param_spec.html#L316" class="js-smell-location">4</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(booleans)::it#converts y/n has a flog score of 50</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;y&quot; })
          controller.param! :foo, TrueClass
          expect(controller.params[&quot;foo&quot;]).to eql(true)

          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;n&quot; })
          controller.param! :foo, TrueClass
          expect(controller.params[&quot;foo&quot;]).to eql(false)
        end

        it &quot;return InvalidParameterError if value not boolean&quot; do
          allow(controller).to receive(:params).and_return({ &quot;foo&quot; =&gt; &quot;1111&quot; })
          expect { controller.param! :foo, :boolean }.to raise_error(RailsParam::Param::InvalidParameterError)
        end

        it &quot;set default boolean&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(coerce)::describe(booleans)::it#set default boolean has a flog score of 26</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({})
          controller.param! :foo, :boolean, default: false
          expect(controller.params[&quot;foo&quot;]).to eql(false)
        end
      end

    end

    describe &#39;validating nested hash&#39; do
      it &#39;typecasts nested attributes&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(validating nested hash)::it#typecasts nested attributes has a flog score of 45</span>          </div>  </li></ol>
        allow(controller).to receive(:params).and_return({ &#39;foo&#39; =&gt; { &#39;bar&#39; =&gt; 1, &#39;baz&#39; =&gt; 2 } })
        controller.param! :foo, Hash do |p|
          p.param! :bar, BigDecimal
          p.param! :baz, Float
        end
        expect(controller.params[&#39;foo&#39;][&#39;bar&#39;]).to be_instance_of BigDecimal
        expect(controller.params[&#39;foo&#39;][&#39;baz&#39;]).to be_instance_of Float
      end

      it &#39;does not raise exception if hash is not required but nested attributes are, and no hash is provided&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L351" class="js-smell-location">0</a>                  <a href="param_spec.html#L455" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(validating nested hash)::it#does not raise exception if hash is not required but nested attributes are, and no hash is provided has a flog score of 28</span>          </div>  </li></ol>
        allow(controller).to receive(:params).and_return(foo: nil)
        controller.param! :foo, Hash do |p|
          p.param! :bar, BigDecimal, required: true
          p.param! :baz, Float, required: true
        end
        expect(controller.params[&#39;foo&#39;]).to be_nil
      end

      it &#39;raises exception if hash is required, nested attributes are not required, and no hash is provided&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L360" class="js-smell-location">0</a>                  <a href="param_spec.html#L464" class="js-smell-location">1</a>                  </div>  </li></ol>
        allow(controller).to receive(:params).and_return(foo: nil)

        expect {
          controller.param! :foo, Hash, required: true do |p|
            p.param! :bar, BigDecimal
            p.param! :baz, Float
          end
        }.to raise_error(RailsParam::Param::InvalidParameterError)
      end

      it &#39;raises exception if hash is not required but nested attributes are, and hash has missing attributes&#39; do
        allow(controller).to receive(:params).and_return({ &#39;foo&#39; =&gt; { &#39;bar&#39; =&gt; 1, &#39;baz&#39; =&gt; nil } })
        expect {
          controller.param! :foo, Hash do |p|
            p.param! :bar, BigDecimal, required: true
            p.param! :baz, Float, required: true
          end
        }.to raise_error(RailsParam::Param::InvalidParameterError)
      end
    end

    describe &#39;validating arrays&#39; do
      it &#39;typecasts array of primitive elements&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(validating arrays)::it#typecasts array of primitive elements has a flog score of 43</span>          </div>  </li></ol>
        allow(controller).to receive(:params).and_return({ &#39;array&#39; =&gt; [&#39;1&#39;, &#39;2&#39;] })
        controller.param! :array, Array do |a, i|
          a.param! i, Integer, required: true
        end
        expect(controller.params[&#39;array&#39;][0]).to be_a Integer
        expect(controller.params[&#39;array&#39;][1]).to be_a Integer
      end

      it &#39;validates array of hashes&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(validating arrays)::it#validates array of hashes has a flog score of 97</span>          </div>  </li></ol>
        params = { &#39;array&#39; =&gt; [{ &#39;object&#39; =&gt; { &#39;num&#39; =&gt; &#39;1&#39;, &#39;float&#39; =&gt; &#39;1.5&#39; } }, { &#39;object&#39; =&gt; { &#39;num&#39; =&gt; &#39;2&#39;, &#39;float&#39; =&gt; &#39;2.3&#39; } }] }
        allow(controller).to receive(:params).and_return(params)
        controller.param! :array, Array do |a|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 2 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L395" class="js-smell-location">0</a>                  <a href="param_spec.html#L434" class="js-smell-location">1</a>                  </div>  </li></ol>
          a.param! :object, Hash do |h|
            h.param! :num, Integer, required: true
            h.param! :float, Float, required: true
          end
        end
        expect(controller.params[&#39;array&#39;][0][&#39;object&#39;][&#39;num&#39;]).to be_a Integer
        expect(controller.params[&#39;array&#39;][0][&#39;object&#39;][&#39;float&#39;]).to be_instance_of Float
        expect(controller.params[&#39;array&#39;][1][&#39;object&#39;][&#39;num&#39;]).to be_a Integer
        expect(controller.params[&#39;array&#39;][1][&#39;object&#39;][&#39;float&#39;]).to be_instance_of Float
      end

      it &#39;validates an array of arrays&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(validating arrays)::it#validates an array of arrays has a flog score of 84</span>          </div>  </li></ol>
        params = { &#39;array&#39; =&gt; [[&#39;1&#39;, &#39;2&#39;], [&#39;3&#39;, &#39;4&#39;]] }
        allow(controller).to receive(:params).and_return(params)
        controller.param! :array, Array do |a, i|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 2 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L410" class="js-smell-location">0</a>                  <a href="param_spec.html#L447" class="js-smell-location">1</a>                  </div>  </li></ol>
          a.param! i, Array do |b, e|
            b.param! e, Integer, required: true
          end
        end
        expect(controller.params[&#39;array&#39;][0][0]).to be_a Integer
        expect(controller.params[&#39;array&#39;][0][1]).to be_a Integer
        expect(controller.params[&#39;array&#39;][1][0]).to be_a Integer
        expect(controller.params[&#39;array&#39;][1][1]).to be_a Integer
      end

      it &#39;raises exception when primitive element missing&#39; do
        allow(controller).to receive(:params).and_return({ &#39;array&#39; =&gt; [&#39;1&#39;, nil] })
        expect {
          controller.param! :array, Array do |a, i|
            a.param! i, Integer, required: true
          end
        }.to raise_error(RailsParam::Param::InvalidParameterError)
      end

      it &#39;raises exception when nested hash element missing&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(validating arrays)::it#raises exception when nested hash element missing has a flog score of 26</span>          </div>  </li></ol>
        params = { &#39;array&#39; =&gt; [{ &#39;object&#39; =&gt; { &#39;num&#39; =&gt; &#39;1&#39;, &#39;float&#39; =&gt; nil } }, { &#39;object&#39; =&gt; { &#39;num&#39; =&gt; &#39;2&#39;, &#39;float&#39; =&gt; &#39;2.3&#39; } }] }
        allow(controller).to receive(:params).and_return(params)
        expect {
          controller.param! :array, Array do |a|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 2 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L395" class="js-smell-location">0</a>                  <a href="param_spec.html#L434" class="js-smell-location">1</a>                  </div>  </li></ol>
            a.param! :object, Hash do |h|
              h.param! :num, Integer, required: true
              h.param! :float, Float, required: true
            end
          end
        }.to raise_error(RailsParam::Param::InvalidParameterError)
      end

      it &#39;raises exception when nested array element missing&#39; do
        params = { &#39;array&#39; =&gt; [[&#39;1&#39;, &#39;2&#39;], [&#39;3&#39;, nil]] }
        allow(controller).to receive(:params).and_return(params)
        expect {
          controller.param! :array, Array do |a, i|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 2 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L410" class="js-smell-location">0</a>                  <a href="param_spec.html#L447" class="js-smell-location">1</a>                  </div>  </li></ol>
            a.param! i, Array do |b, e|
              b.param! e, Integer, required: true
            end
          end
        }.to raise_error(RailsParam::Param::InvalidParameterError)
      end

      it &#39;does not raise exception if array is not required but nested attributes are, and no array is provided&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L351" class="js-smell-location">0</a>                  <a href="param_spec.html#L455" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(validating arrays)::it#does not raise exception if array is not required but nested attributes are, and no array is provided has a flog score of 28</span>          </div>  </li></ol>
        allow(controller).to receive(:params).and_return(foo: nil)
        controller.param! :foo, Array do |p|
          p.param! :bar, BigDecimal, required: true
          p.param! :baz, Float, required: true
        end
        expect(controller.params[&#39;foo&#39;]).to be_nil
      end

      it &#39;raises exception if array is required, nested attributes are not required, and no array is provided&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L360" class="js-smell-location">0</a>                  <a href="param_spec.html#L464" class="js-smell-location">1</a>                  </div>  </li></ol>
        allow(controller).to receive(:params).and_return(foo: nil)
        expect {
          controller.param! :foo, Array, required: true do |p|
            p.param! :bar, BigDecimal
            p.param! :baz, Float
          end
        }.to raise_error(RailsParam::Param::InvalidParameterError)
      end
    end

    describe &quot;validation&quot; do
      describe &quot;required parameter&quot; do
        it &quot;succeeds&quot; do
          allow(controller).to receive(:params).and_return({ &quot;price&quot; =&gt; &quot;50&quot; })
          expect { controller.param! :price, Integer, required: true }.to_not raise_error
        end

        it &quot;raises&quot; do
          allow(controller).to receive(:params).and_return({})
          expect { controller.param! :price, Integer, required: true }.to raise_error(RailsParam::Param::InvalidParameterError, &quot;Parameter price is required&quot;)
        end

        it &quot;raises custom message&quot; do
          allow(controller).to receive(:params).and_return({})
          expect { controller.param! :price, Integer, required: true, message: &quot;No price specified&quot; }.to raise_error(RailsParam::Param::InvalidParameterError, &quot;No price specified&quot;)
        end
      end

      describe &quot;blank parameter&quot; do
        it &quot;succeeds with not empty String&quot; do
          allow(controller).to receive(:params).and_return({ &quot;price&quot; =&gt; &quot;50&quot; })
          expect { controller.param! :price, String, blank: false }.to_not raise_error
        end

        it &quot;raises with empty String&quot; do
          allow(controller).to receive(:params).and_return({ &quot;price&quot; =&gt; &quot;&quot; })
          expect { controller.param! :price, String, blank: false }.to raise_error(RailsParam::Param::InvalidParameterError, &quot;Parameter price cannot be blank&quot;)
        end

        it &quot;succeeds with not empty Hash&quot; do
          allow(controller).to receive(:params).and_return({ &quot;hash&quot; =&gt; { &quot;price&quot; =&gt; &quot;50&quot; } })
          expect { controller.param! :hash, Hash, blank: false }.to_not raise_error
        end

        it &quot;raises with empty Hash&quot; do
          allow(controller).to receive(:params).and_return({ &quot;hash&quot; =&gt; {} })
          expect { controller.param! :hash, Hash, blank: false }.to raise_error(RailsParam::Param::InvalidParameterError, &quot;Parameter hash cannot be blank&quot;)
        end

        it &quot;succeeds with not empty Array&quot; do
          allow(controller).to receive(:params).and_return({ &quot;array&quot; =&gt; [50] })
          expect { controller.param! :array, Array, blank: false }.to_not raise_error
        end

        it &quot;raises with empty Array&quot; do
          allow(controller).to receive(:params).and_return({ &quot;array&quot; =&gt; [] })
          expect { controller.param! :array, Array, blank: false }.to raise_error(RailsParam::Param::InvalidParameterError, &quot;Parameter array cannot be blank&quot;)
        end

        it &quot;succeeds with not empty ActiveController::Parameters&quot; do
          allow(controller).to receive(:params).and_return({ &quot;hash&quot; =&gt; ActionController::Parameters.new({ &quot;price&quot; =&gt; &quot;50&quot; }) })
          expect { controller.param! :hash, Hash, blank: false }.to_not raise_error
        end

        it &quot;raises with empty ActiveController::Parameters&quot; do
          allow(controller).to receive(:params).and_return({ &quot;hash&quot; =&gt; ActionController::Parameters.new() })
          expect { controller.param! :hash, Hash, blank: false }.to raise_error(RailsParam::Param::InvalidParameterError, &quot;Parameter hash cannot be blank&quot;)
        end
      end

      describe &quot;format parameter&quot; do
        it &quot;succeeds&quot; do
          allow(controller).to receive(:params).and_return({ &quot;price&quot; =&gt; &quot;50$&quot; })
          expect { controller.param! :price, String, format: /[0-9]+\$/ }.to_not raise_error
        end

        it &quot;raises&quot; do
          allow(controller).to receive(:params).and_return({ &quot;price&quot; =&gt; &quot;50&quot; })
          expect { controller.param! :price, String, format: /[0-9]+\$/ }.to raise_error(RailsParam::Param::InvalidParameterError, &quot;Parameter price must match format #{/[0-9]+\$/}&quot;)
        end
      end

      describe &quot;is parameter&quot; do
        it &quot;succeeds&quot; do
          allow(controller).to receive(:params).and_return({ &quot;price&quot; =&gt; &quot;50&quot; })
          expect { controller.param! :price, String, is: &quot;50&quot; }.to_not raise_error
        end

        it &quot;raises&quot; do
          allow(controller).to receive(:params).and_return({ &quot;price&quot; =&gt; &quot;51&quot; })
          expect { controller.param! :price, String, is: &quot;50&quot; }.to raise_error(RailsParam::Param::InvalidParameterError, &quot;Parameter price must be 50&quot;)
        end
      end

      describe &quot;min parameter&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 4 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L559" class="js-smell-location">0</a>                  <a href="param_spec.html#L571" class="js-smell-location">1</a>                  <a href="param_spec.html#L583" class="js-smell-location">2</a>                  <a href="param_spec.html#L595" class="js-smell-location">3</a>                  </div>  </li></ol>
        it &quot;succeeds&quot; do
          allow(controller).to receive(:params).and_return({ &quot;price&quot; =&gt; &quot;50&quot; })
          expect { controller.param! :price, Integer, min: 50 }.to_not raise_error
        end

        it &quot;raises&quot; do
          allow(controller).to receive(:params).and_return({ &quot;price&quot; =&gt; &quot;50&quot; })
          expect { controller.param! :price, Integer, min: 51 }.to raise_error(RailsParam::Param::InvalidParameterError, &quot;Parameter price cannot be less than 51&quot;)
        end
      end

      describe &quot;max parameter&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 4 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L559" class="js-smell-location">0</a>                  <a href="param_spec.html#L571" class="js-smell-location">1</a>                  <a href="param_spec.html#L583" class="js-smell-location">2</a>                  <a href="param_spec.html#L595" class="js-smell-location">3</a>                  </div>  </li></ol>
        it &quot;succeeds&quot; do
          allow(controller).to receive(:params).and_return({ &quot;price&quot; =&gt; &quot;50&quot; })
          expect { controller.param! :price, Integer, max: 50 }.to_not raise_error
        end

        it &quot;raises&quot; do
          allow(controller).to receive(:params).and_return({ &quot;price&quot; =&gt; &quot;50&quot; })
          expect { controller.param! :price, Integer, max: 49 }.to raise_error(RailsParam::Param::InvalidParameterError, &quot;Parameter price cannot be greater than 49&quot;)
        end
      end

      describe &quot;min_length parameter&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 4 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L559" class="js-smell-location">0</a>                  <a href="param_spec.html#L571" class="js-smell-location">1</a>                  <a href="param_spec.html#L583" class="js-smell-location">2</a>                  <a href="param_spec.html#L595" class="js-smell-location">3</a>                  </div>  </li></ol>
        it &quot;succeeds&quot; do
          allow(controller).to receive(:params).and_return({ &quot;word&quot; =&gt; &quot;foo&quot; })
          expect { controller.param! :word, String, min_length: 3 }.to_not raise_error
        end

        it &quot;raises&quot; do
          allow(controller).to receive(:params).and_return({ &quot;word&quot; =&gt; &quot;foo&quot; })
          expect { controller.param! :word, String, min_length: 4 }.to raise_error(RailsParam::Param::InvalidParameterError, &quot;Parameter word cannot have length less than 4&quot;)
        end
      end

      describe &quot;max_length parameter&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 4 nodes</span>              <span>Locations:</span>                  <a href="param_spec.html#L559" class="js-smell-location">0</a>                  <a href="param_spec.html#L571" class="js-smell-location">1</a>                  <a href="param_spec.html#L583" class="js-smell-location">2</a>                  <a href="param_spec.html#L595" class="js-smell-location">3</a>                  </div>  </li></ol>
        it &quot;succeeds&quot; do
          allow(controller).to receive(:params).and_return({ &quot;word&quot; =&gt; &quot;foo&quot; })
          expect { controller.param! :word, String, max_length: 3 }.to_not raise_error
        end

        it &quot;raises&quot; do
          allow(controller).to receive(:params).and_return({ &quot;word&quot; =&gt; &quot;foo&quot; })
          expect { controller.param! :word, String, max_length: 2 }.to raise_error(RailsParam::Param::InvalidParameterError, &quot;Parameter word cannot have length greater than 2&quot;)
        end
      end

      describe &quot;in, within, range parameters&quot; do
        before(:each) { allow(controller).to receive(:params).and_return({ &quot;price&quot; =&gt; &quot;50&quot; }) }

        it &quot;succeeds in the range&quot; do
          controller.param! :price, Integer, in: 1..100
          expect(controller.params[&quot;price&quot;]).to eql(50)
        end

        it &quot;raises outside the range&quot; do
          expect { controller.param! :price, Integer, in: 51..100 }.to raise_error(RailsParam::Param::InvalidParameterError, &quot;Parameter price must be within 51..100&quot;)
        end
      end

      describe &quot;custom validator&quot; do
        let(:custom_validation) { lambda { |v| raise RailsParam::Param::InvalidParameterError, &#39;Number is not even&#39; if v % 2 != 0 } }

        it &quot;succeeds when valid&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(.param!)::describe(validation)::describe(custom validator)::it#succeeds when valid has a flog score of 28</span>          </div>  </li></ol>
          allow(controller).to receive(:params).and_return({ &quot;number&quot; =&gt; &quot;50&quot; })
          controller.param! :number, Integer, custom: custom_validation
          expect(controller.params[&quot;number&quot;]).to eql(50)
        end

        it &quot;raises when invalid&quot; do
          allow(controller).to receive(:params).and_return({ &quot;number&quot; =&gt; &quot;51&quot; })
          expect do
            controller.param! :number, Integer, custom: custom_validation
          end.to raise_error(RailsParam::Param::InvalidParameterError, &#39;Number is not even&#39;)
        end
      end
    end
  end
end
</code>
  </div>
</div>

        </div>
      </div>
    </div>

    <!-- JavaScripts -->
    <script src='../../assets/javascripts/jquery.min.js'></script>
    <script src='../../assets/javascripts/jquery.tablesorter.min.js'></script>
    <script src='../../assets/javascripts/jquery.scrollTo.min.js'></script>
    <script src='../../assets/javascripts/jquery.timeago.js'></script>
    <script src='../../assets/javascripts/highcharts.src-4.0.1.js'></script>
    <script src='../../assets/javascripts/prettify.js'></script>
    <script src='../../assets/javascripts/bootstrap.min.js'></script>
    <script src='../../assets/javascripts/application.js'></script>
    <script src='../../assets/javascripts/jquery.filtertable.min.js'></script>
  </body>
</html>
